---
title: "Global TB Mortality Analysis (2000–2020)"
author: "Bilal Ahmed"
format: html
---

# Introduction

This report analyzes the estimated number of **tuberculosis (TB) deaths per 100,000 people** across countries between **2000 and 2020**. The goal is to build an interactive dashboard similar to [Our World in Data](https://ourworldindata.org/) to explore trends, changes, and the global burden of TB using three views:

- **Data Table**: Showing absolute and relative changes in TB death rates.
- **Line Chart**: TB death trends over time for selected countries.
- **Choropleth Map**: Animated world map showing annual TB death rates.

# Setup

Make sure the following packages are installed in your virtual environment:

```{python}
import pandas as pd
import numpy as np
import plotly.express as px
from itables import show
import country_converter as coco
```

# Data Import
```{python}
# Load the dataset
tb_df = pd.read_csv("data/all_forms_of_tb_deaths_per_100000_estimated.csv")
tb_df.head()
```
# Data Cleaning
```{python}
# Ensure columns are clean
tb_df.columns = tb_df.columns.str.strip()

# Melt to long format
tb_long = tb_df.melt(id_vars="country", var_name="year", value_name="deaths_per_100k")
tb_long["year"] = pd.to_numeric(tb_long["year"], errors="coerce")
tb_long["deaths_per_100k"] = pd.to_numeric(tb_long["deaths_per_100k"], errors="coerce")

# Drop missing
tb_long = tb_long.dropna(subset=["deaths_per_100k"])
```
# Table Section
Compare TB deaths in 2000 vs 2020 with absolute and relative change.
```{python}
import pandas as pd
import numpy as np

# Assuming your TB data is already loaded in tb_df with country and years from 2000 to 2020

# Create the summary table
table_df = tb_df.copy()

# Calculate Absolute Change
table_df["Absolute Change"] = table_df["2020"] - table_df["2000"]

# Avoid divide-by-zero by replacing 0 with NaN for safe division
table_df["Relative Change"] = np.where(
    table_df["2000"] == 0,
    np.nan,
    (table_df["Absolute Change"] / table_df["2000"]) * 100
)

# Round and format Relative Change
table_df["Relative Change"] = (
    table_df["Relative Change"]
    .round(0)
    .astype("Int64")
    .astype(str)
    .replace("<NA>%", "N/A") + "%"  # Handle NaN nicely
)

# Round Absolute Change
table_df["Absolute Change"] = table_df["Absolute Change"].round(1)

# Show the top rows
table_df[["country", "2000", "2020", "Absolute Change", "Relative Change"]].head()
```

# Chart Section
```{python}
import pandas as pd
import plotly.express as px

# Step 1: Calculate average deaths per country
avg_deaths = tb_long.groupby("country")["deaths_per_100k"].mean().sort_values(ascending=False)

# Step 2: Select top 5 countries
top_countries = avg_deaths.head(5).index.tolist()

# Step 3: Filter data
subset = tb_long[(tb_long["country"].isin(top_countries)) & (tb_long["year"].between(2000, 2020))]

# Step 4: Plot area chart
fig_area = px.area(
    subset,
    x="year",
    y="deaths_per_100k",
    color="country",
    title="Top 5 Countries with Highest Average TB Deaths per 100,000 (2000–2020)",
    labels={
        "deaths_per_100k": "Deaths per 100K",
        "year": "Year",
        "country": "Country"
    },
    line_group="country"
)

fig_area.update_traces(mode="lines", line=dict(width=2))
fig_area.update_layout(template="plotly_dark", hovermode="x unified")
fig_area.show()
```
# Mapping Section
Animated world map of TB deaths per 100,000 from 2000–2020.
```{python}
# Country codes
tb_long["iso3"] = coco.convert(tb_long["country"], to="ISO3")

# Choropleth map
fig_map = px.choropleth(
    tb_long,
    locations="iso3",
    color="deaths_per_100k",
    hover_name="country",
    animation_frame="year",
    title="Global TB Deaths per 100,000 (2000–2020)",
    color_continuous_scale="Reds",
    labels={"deaths_per_100k": "Deaths/100K"}
)

fig_map.update_layout(coloraxis_colorbar=dict(title="TB Deaths/100K"))
fig_map.show()
```

# Final Tabset

Below, we place our results into a tabbed interface.

::: {.panel-tabset}

### Table

```{python}
#| echo: false
show(table_df)

### Chart
#| echo: false
fig_area.show()

### MAP
#| echo: false
fig_map.show()
```

# Research Insights
Overall Decline: Many countries like China and Brazil have reduced TB death rates significantly, indicating success in public health efforts.

High-Burden Countries: India and South Africa still exhibit higher TB mortality compared to global averages.

Disparities: Low-income and conflict-affected countries show persistent or increasing TB mortality due to weak health systems.

Policy Implication: Investment in TB detection, treatment, and prevention should continue—especially in Sub-Saharan Africa and South Asia.
:::